<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Parvassive Playz Dashboard</title>
    
    <!-- CSS & Icon Assets -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- STABLE FIREBASE V8 (Standard Scripts - Works Everywhere) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        :root {
            --neon-cyan: #00f3ff;
            --neon-purple: #bc13fe;
            --bg-dark: #050510;
        }

        /* --- STABILITY NAVIGATION (DNA LOCKED) --- */
        .section-view {
            display: none !important;
            height: calc(100vh - 80px);
            overflow-y: auto;
            width: 100%;
            padding: 20px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .section-view.active {
            display: flex !important;
            flex-direction: column;
            opacity: 1;
        }

        /* --- THEME DNA --- */
        body { margin: 0; background: var(--bg-dark); color: #fff; font-family: 'Rajdhani', sans-serif; height: 100vh; overflow: hidden; transition: background 0.4s ease; }
        body.light-mode { background: #f4f4f9; color: #1a1a1a; }
        .cyber-font { font-family: 'Orbitron', sans-serif; }
        
        .panel { background: rgba(13, 13, 31, 0.96); border: 1px solid rgba(0, 243, 255, 0.2); border-radius: 20px; padding: 20px; width: 100%; box-shadow: 0 10px 30px rgba(0,0,0,0.5); position: relative; }
        body.light-mode .panel { background: #fff; border-color: #ddd; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }

        .bottom-nav { position: fixed; bottom: 0; width: 100%; height: 80px; background: #0d0d1f; border-top: 2px solid var(--neon-purple); display: flex; z-index: 1000; }
        body.light-mode .bottom-nav { background: #fff; border-top: 2px solid #ccc; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #555; background: none; border: none; outline: none !important; }
        .nav-item.active { color: var(--neon-cyan); text-shadow: 0 0 10px var(--neon-cyan); }
        body.light-mode .nav-item.active { color: var(--neon-purple); }

        /* Theme Toggle DNA */
        .theme-btn { position: fixed; top: 20px; right: 20px; width: 48px; height: 48px; border-radius: 50%; background: #0d0d1f; border: 2px solid var(--neon-cyan); z-index: 2000; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 15px var(--neon-cyan); }
        .swirl { animation: swirlAnim 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        @keyframes swirlAnim { 0% { transform: rotate(0) scale(1); } 50% { transform: rotate(180deg) scale(0.3); } 100% { transform: rotate(360deg) scale(1); } }

        /* COMMS Switcher DNA */
        .mode-switch { display: flex; background: rgba(0,0,0,0.4); border-radius: 14px; padding: 5px; margin-bottom: 20px; border: 1px solid rgba(188, 19, 254, 0.4); }
        .mode-btn { flex: 1; padding: 10px; border-radius: 10px; font-size: 11px; font-weight: 900; color: #666; transition: 0.3s ease; }
        .mode-btn.active { background: var(--neon-purple); color: #fff; box-shadow: 0 0 15px var(--neon-purple); }
        .hidden-pane { display: none !important; }

        /* Chat DNA with Real-Time Timestamp */
        #chatDisplay { height: 280px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 15px; margin-bottom: 15px; border: 1px solid rgba(0, 243, 255, 0.1); }
        .chat-msg { animation: chatPop 0.3s ease-out; max-width: 85%; display: flex; flex-direction: column; margin-bottom: 4px; }
        .msg-info { display: flex; align-items: center; gap: 8px; margin-bottom: 2px; }
        .msg-tag { font-family: 'Orbitron'; font-size: 9px; font-weight: 900; letter-spacing: 0.5px; }
        .msg-time { font-size: 8px; opacity: 0.4; font-weight: bold; }
        .msg-bubble { padding: 10px 14px; border-radius: 15px; font-size: 13px; word-wrap: break-word; line-height: 1.4; border: 1px solid transparent; }
        .msg-other .msg-bubble { background: rgba(188, 19, 254, 0.12); border-color: var(--neon-purple); color: #fff; border-bottom-left-radius: 2px; }
        .msg-me .msg-bubble { background: rgba(0, 243, 255, 0.12); border-color: var(--neon-cyan); color: #fff; border-bottom-right-radius: 2px; }
        .msg-me { align-self: flex-end; }
        .msg-me .msg-info { flex-direction: row-reverse; }
        @keyframes chatPop { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        /* Overlays DNA */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(5, 5, 16, 0.98); z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 30px; text-align: center; }
        .btn-yes { background: #00e676; width: 100%; padding: 16px; border-radius: 12px; color: #000; font-weight: 900; margin-bottom: 12px; }
        .btn-no { background: #ff1744; width: 100%; padding: 16px; border-radius: 12px; color: #fff; font-weight: 900; }

        /* Status Blinking DNA */
        #statTxt { animation: blinkStatus 1.5s infinite alternate; font-weight: 900; color: #00ff00; }
        @keyframes blinkStatus { 0% { opacity: 0.4; } 100% { opacity: 1; text-shadow: 0 0 10px #00ff00; } }

        /* Avatar DNA */
        .avatar-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-top: 15px; }
        .avatar-img { width: 100%; aspect-ratio: 1; border-radius: 12px; border: 2px solid #222; }
        .avatar-img.selected { border-color: var(--neon-cyan); box-shadow: 0 0 15px var(--neon-cyan); }
    </style>
</head>
<body>

    <button id="themeBtn" class="theme-btn" onclick="toggleTheme()">
        <i id="themeIcon" class="fas fa-sun text-white"></i>
    </button>

    <div id="confirmOverlay" class="overlay">
        <img id="tempPreview" src="" class="w-52 h-52 rounded-full border-4 border-[var(--neon-cyan)] mb-8 object-cover shadow-[0_0_25px_var(--neon-cyan)]">
        <h2 class="cyber-font text-xl mb-10 uppercase tracking-widest">Set as Profile Photo?</h2>
        <div class="w-full max-w-xs">
            <button onclick="saveProfilePic()" class="btn-yes cyber-font">YES</button>
            <button onclick="closeProfileOverlay()" class="btn-no cyber-font">NO</button>
        </div>
    </div>

    <div id="successOverlay" class="overlay">
        <div class="w-24 h-24 rounded-full border-4 border-green-500 flex items-center justify-center mb-8">
            <i class="fas fa-check text-4xl text-green-500"></i>
        </div>
        <h2 class="cyber-font text-xl mb-4 tracking-widest">TRANSMISSION SENT</h2>
        <button onclick="document.getElementById('successOverlay').style.display='none'" class="btn-yes cyber-font" style="max-width: 180px">OK</button>
    </div>

    <main>
        <!-- SECTION: HOME -->
        <section id="view-home" class="section-view active justify-center items-center text-center">
            <img src="logo.jpg" onerror="this.src='https://via.placeholder.com/150/000/00f3ff?text=LOGO'" class="w-48 h-48 rounded-full border-4 border-[var(--neon-cyan)] shadow-[0_0_25px_var(--neon-cyan)] mb-10">
            <div class="panel max-w-xs border-t-4 border-[var(--neon-purple)]">
                <h2 class="cyber-font text-xl text-[var(--neon-purple)] font-bold">NOT A GAMER</h2>
                <h1 class="cyber-font text-2xl text-[var(--neon-cyan)] font-black mt-1">BUT A GAME CHANGER</h1>
                <p class="text-[9px] uppercase tracking-[0.3em] opacity-40 mt-6">Parvassive Playz Hub</p>
            </div>
        </section>

        <!-- SECTION: COMMS -->
        <section id="view-comms" class="section-view">
            <h2 class="cyber-font text-2xl text-[var(--neon-cyan)] mb-6 uppercase">Comms Center</h2>
            <div class="mode-switch">
                <button id="mode-global" class="mode-btn active cyber-font" onclick="switchCommsMode('global')">GLOBAL FREQUENCY</button>
                <button id="mode-direct" class="mode-btn cyber-font" onclick="switchCommsMode('direct')">DIRECT LINK</button>
            </div>
            
            <div id="pane-global" class="panel">
                <div id="chatDisplay"><p class="text-center opacity-30 mt-20 uppercase font-black tracking-widest">Syncing signal...</p></div>
                <div class="flex gap-2">
                    <input type="text" id="chatInput" class="flex-1 bg-black/50 border border-[var(--neon-cyan)] rounded-xl p-3 text-white outline-none" placeholder="Enter message...">
                    <button onclick="sendGlobalMessage()" class="w-12 h-12 bg-[var(--neon-cyan)] text-black rounded-xl flex items-center justify-center shadow-[0_0_10px_var(--neon-cyan)]"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>

            <div id="pane-direct" class="panel hidden-pane border-l-4 border-[var(--neon-purple)]">
                <h3 class="cyber-font text-[10px] text-[var(--neon-purple)] uppercase mb-6 tracking-[0.2em]">Secure Transmission to Admin</h3>
                <textarea id="msgText" class="w-full min-h-[150px] bg-black/50 border border-[var(--neon-cyan)] rounded-xl p-4 text-white outline-none resize-none focus:border-[var(--neon-purple)]" placeholder="Type your personal message..."></textarea>
                <button type="button" id="sendBtn" onclick="submitTransmission()" class="w-full mt-6 py-5 bg-[var(--neon-cyan)] text-black font-black cyber-font text-xs rounded-2xl shadow-[0_0_20px_var(--neon-cyan)] uppercase tracking-widest">SEND TRANSMISSION</button>
            </div>
        </section>

        <!-- SECTION: UPDATES -->
        <section id="view-updates" class="section-view">
            <h2 class="cyber-font text-2xl text-[var(--neon-cyan)] mb-6 uppercase">Updates</h2>
            <div class="panel border-l-4 border-[var(--neon-purple)]">
                <h3 class="font-bold text-lg">System Synchronized</h3>
                <p class="text-sm opacity-60 mt-1">Real-time chat and transmission protocols are active with global stabilization.</p>
            </div>
        </section>

        <!-- SECTION: ACCOUNT -->
        <section id="view-account" class="section-view">
            <div class="flex justify-between items-center mb-8">
                <h2 class="cyber-font text-2xl text-[var(--neon-purple)] uppercase">ACCOUNT</h2>
                <div class="flex items-center gap-2">
                    <span id="statDot" class="w-2 h-2 rounded-full bg-green-500"></span>
                    <span id="statTxt" class="cyber-font text-[10px] font-bold">â€¢ONLINE</span>
                </div>
            </div>
            <div class="panel flex flex-col items-center mb-6">
                <img id="userPfp" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" class="w-36 h-36 rounded-full border-4 border-[var(--neon-purple)] mb-6 object-cover bg-black shadow-[0_0_20px_rgba(188,19,254,0.3)]">
                <div class="w-full">
                    <label class="text-[10px] font-bold text-[var(--neon-cyan)] uppercase mb-1 block tracking-widest">GamerTag</label>
                    <input type="text" id="userTag" value="Parvassive_Gamer" class="w-full bg-black/50 border border-[var(--neon-purple)] rounded-xl p-4 text-center cyber-font text-[var(--neon-cyan)] outline-none">
                </div>
            </div>
            <div class="panel mb-8">
                <p class="cyber-font text-[10px] text-[var(--neon-cyan)] mb-3 uppercase tracking-widest">Preset Avatars</p>
                <div id="avatarList" class="avatar-grid"></div>
            </div>
            <button onclick="document.getElementById('fileInput').click()" class="w-full py-5 border-2 border-dashed border-[var(--neon-purple)] rounded-2xl text-[var(--neon-purple)] cyber-font text-[11px] font-bold tracking-widest uppercase">UPLOAD CUSTOM</button>
            <input type="file" id="fileInput" class="hidden" accept="image/*" onchange="previewProfileFile(this)">
        </section>
    </main>

    <nav class="bottom-nav">
        <button id="nav-home" class="nav-item active" onclick="goTo('home')"><i class="fas fa-home text-2xl mb-1"></i><span class="text-[9px] font-bold uppercase">HOME</span></button>
        <button id="nav-comms" class="nav-item" onclick="goTo('comms')"><i class="fas fa-satellite-dish text-2xl mb-1"></i><span class="text-[9px] font-bold uppercase">COMMS</span></button>
        <button id="nav-updates" class="nav-item" onclick="goTo('updates')"><i class="fas fa-bolt text-2xl mb-1"></i><span class="text-[9px] font-bold uppercase">UPDATES</span></button>
        <button id="nav-account" class="nav-item" onclick="goTo('account')"><i class="fas fa-user-cog text-2xl mb-1"></i><span class="text-[9px] font-bold uppercase">ACCOUNT</span></button>
    </nav>

    <!-- CORE LOGIC: SINGLE UNIFIED ENGINE (NO MODULES) -->
    <script>
        // --- 1. FIREBASE DNA (VERSION 8 BULLETPROOF) ---
        var firebaseConfig = {
            apiKey: "AIzaSyD2eXHBK9jPsH0kXSe2o0tcf5rCJ_e5pkI",
            authDomain: "parvassive-playz-58b33.firebaseapp.com",
            projectId: "parvassive-playz-58b33",
            storageBucket: "parvassive-playz-58b33.firebasestorage.app",
            messagingSenderId: "746566807541",
            appId: "1:746566807541:web:f727f7697b9d709e26fabc"
        };
        firebase.initializeApp(firebaseConfig);
        var db = firebase.firestore();
        var auth = firebase.auth();
        var appId = 'parvassive-playz-58b33';

        // --- 2. GLOBAL BRIDGE (STOPS "NOT DEFINED" ERRORS) ---
        window.goTo = function(id) {
            document.querySelectorAll('.section-view').forEach(function(s){ s.classList.remove('active'); });
            document.getElementById('view-' + id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(function(n){ n.classList.remove('active'); });
            document.getElementById('nav-' + id).classList.add('active');
            document.getElementById('themeBtn').style.display = (id === 'account') ? 'none' : 'flex';
        };

        window.toggleTheme = function() {
            var body = document.body;
            var btn = document.getElementById('themeBtn');
            var icon = document.getElementById('themeIcon');
            btn.classList.add('swirl');
            setTimeout(function() {
                var isLight = body.classList.toggle('light-mode');
                icon.className = isLight ? 'fas fa-moon' : 'fas fa-sun';
            }, 300);
            setTimeout(function() { btn.classList.remove('swirl'); }, 600);
        };

        window.switchCommsMode = function(mode) {
            document.getElementById('pane-global').classList.toggle('hidden-pane', mode !== 'global');
            document.getElementById('pane-direct').classList.toggle('hidden-pane', mode !== 'direct');
            document.getElementById('mode-global').classList.toggle('active', mode === 'global');
            document.getElementById('mode-direct').classList.toggle('active', mode === 'direct');
        };

        // --- 3. REAL-TIME CHAT ENGINE (DNA: INSTAGRAM STYLE TIMESTAMPS) ---
        auth.signInAnonymously().then(function() {
            db.collection('artifacts').doc(appId).collection('public').doc('data').collection('globalChat')
            .orderBy('timestamp', 'asc').onSnapshot(function(snap) {
                var html = '';
                snap.forEach(function(doc) {
                    var m = doc.data();
                    var isMe = m.uid === auth.currentUser.uid;
                    var timeStr = m.timestamp ? new Date(m.timestamp.toMillis()).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) : '...';
                    html += '<div class="chat-msg ' + (isMe?'msg-me':'msg-other') + '">' +
                        '<div class="msg-info"><span class="msg-tag" style="color:' + (isMe?'var(--neon-cyan)':'var(--neon-purple)') + '">' + (m.tag||'GUEST') + '</span><span class="msg-time">' + timeStr + '</span></div>' +
                        '<div class="msg-bubble">' + m.text + '</div></div>';
                });
                var display = document.getElementById('chatDisplay');
                display.innerHTML = html || '<p class="text-center opacity-30 mt-20 uppercase font-black">No signals found.</p>';
                display.scrollTop = display.scrollHeight;
            });
        });

        window.sendGlobalMessage = function() {
            var input = document.getElementById('chatInput');
            var text = input.value.trim();
            if (!text || !auth.currentUser) return;
            db.collection('artifacts').doc(appId).collection('public').doc('data').collection('globalChat').add({
                text: text, tag: document.getElementById('userTag').value, uid: auth.currentUser.uid, timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
            input.value = '';
        };

        // --- 4. WEB3FORMS ENGINE (SILENT TRANSMISSION) ---
        window.submitTransmission = function() {
            var msg = document.getElementById('msgText').value.trim();
            var btn = document.getElementById('sendBtn');
            var tag = document.getElementById('userTag').value;
            if(!msg) return alert("TYPE A MESSAGE.");
            btn.innerText = "ENCODING..."; btn.disabled = true;
            
            fetch('https://api.web3forms.com/submit', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ access_key: 'f5564d33-134e-443d-94e9-c8952be43b59', name: tag, message: msg, subject: 'Dashboard Link: ' + tag })
            }).then(function(r) { return r.json(); }).then(function(data) {
                if(data.success) { document.getElementById('successOverlay').style.display = 'flex'; document.getElementById('msgText').value = ''; }
            }).finally(function() { btn.innerText = "SEND TRANSMISSION"; btn.disabled = false; });
        };

        // --- 5. ACCOUNT & AVATAR LOGIC ---
        window.previewProfileFile = function(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) { document.getElementById('tempPreview').src = e.target.result; document.getElementById('confirmOverlay').style.display = 'flex'; };
                reader.readAsDataURL(input.files[0]);
            }
        };
        window.saveProfilePic = function() { document.getElementById('userPfp').src = document.getElementById('tempPreview').src; window.closeProfileOverlay(); };
        window.closeProfileOverlay = function() { document.getElementById('confirmOverlay').style.display = 'none'; document.getElementById('fileInput').value = ''; };

        // Avatar Init
        var avatarBox = document.getElementById('avatarList');
        for(var i=1; i<=10; i++) {
            var img = document.createElement('img');
            img.src = 'https://api.dicebear.com/7.x/avataaars/svg?seed=P_' + i;
            img.className = 'avatar-img bg-gray-900';
            img.onclick = (function(s, el){ return function(){
                document.querySelectorAll('.avatar-img').forEach(function(a){ a.classLi
